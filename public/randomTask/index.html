<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">
  <!-- Typicons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/typicons/2.0.9/typicons.css"/>
  <!-- Flavicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
  <title>Random Task</title>
</head>

<body>
<style>
  *{
    font-family: 'Nunito', sans-serif;
    color: darkslategrey;
    box-sizing: border-box;
  }
  #listSection{
    position: relative;
  }
  #clickScreen{
    position: absolute;
    width: 100vw;
    height: 100vh;
    top: 0;
    left: 0;
    z-index: 500;
    background-color: rgba(255, 255, 255, 0);
  }
  button {
    border-top: 2px solid darkslategrey;
    border-left: 2px solid darkslategrey;
    border-right: 4px solid darkslategrey;
    border-bottom: 4px solid darkslategrey;
    border-radius: 5px;
    padding: 5px 10px;
    width: fit-content;
    color: darkslategrey;
    text-align: center;
    font-size: 1em;
    font-weight: 600;
    background-color: lightgrey;
  }
  button span:nth-of-type(1){
    padding-right: 5px;
  }
  button span:nth-of-type(2){
    padding-left: 5px;
  }
  input[type="text"]{
    border-top: 2px solid darkslategrey;
    border-left: 2px solid darkslategrey;
    border-right: 4px solid darkslategrey;
    border-bottom: 4px solid darkslategrey;
    border-radius: 5px;
    padding: 5px 10px;
    width: fit-content;
    color: darkslategrey;
    font-size: 1em;
    font-weight: 600;
  }
  input[type="radio"]{
    display: none;
  }
  .topList{
    margin-bottom: 0;
  }
  .sousBtn{
    margin-top: 0;
  }
  #listSection{
    text-align: left;
  }
  #toDoSection{
    display: flex;
    flex-flow: column nowrap;
    text-align: center;
  }
  #toDoSection button{
    width: fit-content;
    margin: 10px auto;
  }
  #taskToDo{
    color: darkmagenta;
    font-size: 1.5em;
    font-weight: 700;
  }
  ul{
    list-style: none;
    padding: 0;
  }
  #list{
    margin-top: 0;
    width: 100%;
  }
  #list li{
    width: 100%;
    position: relative;
    font-weight: 600;
  }
  .colorSpan{
    position: absolute;
    top: -4px;
    right: 0;
  }
  li span{
    padding-right: 3px;
    font-size: 1.3em;
  }
  .emptyCheck{
    display: inline-block;
    font-size: 2em;
    translate: 0 3.5px;
    line-height: 15px;
  }
  .trashCan{
    padding-left: 10px;
    font-size: 1.5em;
  }
  
  #colorPalet{
    background-color: white;
    border: 2px solid darkslategrey;
    border-radius: 5px;
    position: absolute;
    z-index: 1000;
    top: 2px;
    right: 2.5px;
  }
  .colorTd{
    width: fit-content;
    height: 25px;
    border: none;
  }
  input[name="colorRadio"] + label > div{
    width: 70px;
    height: 25px;
    display: flex;
    justify-items: center;
    align-items: center;
    border-radius: 2.5px;
  }
  input[name="colorRadio"]:checked + label > div{
    background-color: rgba(40, 70, 70, .3);
 
  }
  .colorDiv{
    width: 65px;
    height: 20px;
    border-radius: 25px;
    border: none;
    margin: auto;
    line-height: 14px;
    text-align: center;
    font-size: 14px;
    padding: 3px 7px 4px;
  }
  .orange{
    background-color: orange;
  }
  .red{
    background-color: red;
  }
  .darkmagenta{
    background-color: darkmagenta;
    color: white;
  }
  .dodgerblue {
    background-color: dodgerblue;
  }
  .forestgreen{
    background-color: forestgreen;
    color: white;
  }
  .darkslategrey{
    background-color: darkslategrey;
    color: white;
  }
  
  hr{
    margin: 30px 0 0;
  }
  #doneZone{
    margin-top: 8px;
  }
  #doneZone li:not(span){
    text-decoration: line-through;
  }
  #doneZone p{
    margin-bottom: 0;
    text-decoration: underline;
  }
  .displayNone{
    display: none!important;
  }
</style>
  <div id="listSection">
    <div id="clickScreen" class="displayNone"></div>
    <form id="addForm">
      <input id="addInput" type="text" />
      <button id="addBtn" type="submit">add</button>
    </form>
    <h5 class="topList">The never ending list...</h5>
    <ul id="list"></ul>
    <!-- errands, housework, computer, cellphone, people -->
      <!-- <table id="colorPalet" class="displayNone">
        <tr class="colorTr">
          <td class="colorTd">
            <input type="radio" id="orangeRadio" name="colorRadio" value="orange" />
            <label for="orangeRadio">
              <div>
                <div class="colorDiv orange"></div>
              </div>
            </label>
          </td>
          <td class="colorTd">
            <input type="radio" id="redRadio" name="colorRadio" value="red" />
            <label for="redRadio">
              <div>
                <div class="colorDiv red"></div>
              </div>
            </label>
          </td>
          <td class="colorTd">
            <input type="radio" id="darkmagentaRadio" name="colorRadio" value="darkmagenta" />
            <label for="darkmagentaRadio">
              <div>
                <div class="colorDiv darkmagenta"></div>
              </div>
            </label>
          </td>
        </tr>
        <tr class="colorTr">
          <td class="colorTd">
            <input type="radio" id="dodgerblueRadio" name="colorRadio" value="dodgerblue" />
            <label for="dodgerblueRadio">
              <div>
                <div class="colorDiv dodgerblue"></div>
              </div>
            </label>
          </td>
          <td class="colorTd">
            <input type="radio" id="forestgreenRadio" name="colorRadio" value="forestgreen" />
            <label for="forestgreenRadio">
              <div>
                  <div class="colorDiv forestgreen"></div>
              </div>
            </label>
          </td>
          <td class="colorTd">
            <input type="radio" id="darkslategreyRadio" name="colorRadio" value="darkslategrey" checked/>
            <label for="darkslategreyRadio">
              <div>
                <div class="colorDiv darkslategrey"></div>
              </div>
            </label>
          </td>
        </tr>
      </table>-->
      <table id="colorPalet" class="displayNone">
        <tr class="colorTr">
          <td class="colorTd">
            <input type="radio" id="orangeRadio" name="colorRadio" value="orange" />
            <label for="orangeRadio">
              <div>
                <div class="colorDiv orange">people</div>
              </div>
            </label>
          </td>
          <td class="colorTd">
            <input type="radio" id="redRadio" name="colorRadio" value="red" />
            <label for="redRadio">
              <div>
                <div class="colorDiv red">urgent</div>
              </div>
            </label>
          </td>
        </tr>
        <tr class="colorTr">
          <td class="colorTd">
            <input type="radio" id="darkmagentaRadio" name="colorRadio" value="darkmagenta" />
            <label for="darkmagentaRadio">
              <div>
                <div class="colorDiv darkmagenta">errand</div>
              </div>
            </label>
          </td>
          <td class="colorTd">
            <input type="radio" id="dodgerblueRadio" name="colorRadio" value="dodgerblue" />
            <label for="dodgerblueRadio">
              <div>
                <div class="colorDiv dodgerblue">screen</div>
              </div>
            </label>
          </td>
        </tr>
        <tr class="colorTr">
          <td class="colorTd">
            <input type="radio" id="forestgreenRadio" name="colorRadio" value="forestgreen" />
            <label for="forestgreenRadio">
              <div>
                  <div class="colorDiv forestgreen">physic</div>
              </div>
            </label>
          </td>
          <td class="colorTd">
            <input type="radio" id="darkslategreyRadio" name="colorRadio" value="darkslategrey" checked/>
            <label for="darkslategreyRadio">
              <div>
                <div class="colorDiv darkslategrey">else</div>
              </div>
            </label>
          </td>
        </tr>
      </table>
    <button id="shuffleBtn">Shuffle it!</button>
    <h5 class="sousBtn">Tell me what to do!</h5>
    <hr />
    <h3>Done Zone</h3>
    <ul id="doneZone"></ul>
  </div>
  <div id="toDoSection" class="displayNone">
    <h3>Fac l√†,<br />pour les 30 prochaines minutes,<br />tu vas...</h3>
    <p id="taskToDo"></p>
    <button id="nopeNextBtn"><span class="typcn typcn-arrow-sync"></span>Nope, next!<span class="typcn typcn-arrow-sync"></span></button>
    <button id="doneNextBtn"><span class="typcn typcn-thumbs-up"></span>Done, next!!<span class="typcn typcn-arrow-right-outline"></span></button>
    <button id="backBtn"><span class="typcn typcn-arrow-left-outline"></span>Back!</button>
  </div>
<script>
  let listTasks = [];
  let listDones = [];
  let num = 0;
  
  if(localStorage.getItem("listTasks")){
    listTasks = JSON.parse(localStorage.listTasks);
    //listTasks = localStorage.getItem("listTasks");
    //console.log(listTasks);
    listTasks.forEach(todo => {
      let li = document.createElement("li");
      li.innerHTML = `<span class="typcn typcn-media-stop-outline emptyCheck" onclick="checkEvent(this)"></span>${todo.task}<span class="typcn typcn-tag colorSpan" onclick="colorChoice(this)"></span>`;
      li.style.color = todo.color;
      list.appendChild(li);
    });
  };
  
  if(localStorage.getItem("listDones")){
    listDones = JSON.parse(localStorage.listDones);
    //listLi = listDones.map(doned => {
      //return `<li>${doned.date}<span class="typcn typcn-tick"></span>${doned.task}<span class="typcn typcn-trash trashCan"></span></li>`
    //});
    //doneZone.innerHTML = listLi.join("");
    let donedDates = [];
    listDones.forEach(doned => {
      if(!donedDates.includes(doned.date)){
        donedDates.push(doned.date);
      };
    });
    donedDates.forEach(donedDate => {
      if(!document.getElementById(donedDate)){
        let donedUlP = document.createElement("p");
        donedUlP.setAttribute("id", donedDate + "p");
        donedUlP.innerText = donedDate;
        doneZone.appendChild(donedUlP);
        let donedUl = document.createElement("ul");
        donedUl.setAttribute("id", donedDate);
        donedUlP.insertAdjacentElement("afterend", donedUl);
      };
    });
    listDones.forEach(doned => {
      let donedDate = doned.date;
      let donedLi = document.createElement("li");
      donedLi.innerHTML = `<span class="typcn typcn-tick"></span>${doned.task}<span class="typcn typcn-trash trashCan" onclick="trashCanEvent(this)"></span>`;
      donedLi.style.color = doned.color;
      document.getElementById(donedDate).appendChild(donedLi);
    });
  };
  
  function checkEvent(emptyCheck){
    console.log("checkEvent");
    console.log(listTasks);
    emptyCheck.parentElement.classList.add("displayNone");
    let color = emptyCheck.parentElement.style.color;
    let task = emptyCheck.parentElement.textContent;
    let donedId = listTasks.indexOf(task);
    console.log(color);
    gotItDone(donedId, color);
  };
  //const colorList = ["orange", "red", "darkmagenta", "dodgerblue", "forestgreen", "darkslategrey"];
  let colorTag;
  function colorChoice(thisOne){
    colorTag = thisOne;
    colorTag.insertAdjacentElement("afterend", colorPalet);
    colorPalet.classList.remove("displayNone");
    clickScreen.classList.remove("displayNone");
    document.querySelectorAll("input[name='colorRadio']").forEach(radio => {
      radio.addEventListener("click", () => {
        let color = radio.value;
        let li = colorTag.parentElement;
        //li.classList.remove(...colorList);
        li.style.color = color;
//update the todo in listTasks
      });
    });
    document.querySelector("#clickScreen").addEventListener("click", clickHandlerColor);
  };
  
  function clickHandlerColor(){
    colorPalet.classList.add("displayNone");
    clickScreen.classList.add("displayNone");
    document.querySelector("#clickScreen").removeEventListener("click", clickHandlerColor);
  };
  
  function trashCanEvent(trashCan){
    console.log("trashCanEvent");
    let trashedLi = trashCan.parentElement;
    trashedLi.classList.add("displayNone");
    let trashedTask = trashedLi.textContent;
    let trashedTaskId = listDones.indexOf(trashedTask);
    let trashedObject = listDones.splice(trashedTaskId, 1);
    let trashedPDate = trashedObject[0].date;
    let dateCount = listDones.filter((td) => td.date == trashedPDate).length;
    if(dateCount == 0){
      document.getElementById(trashedPDate + "p").classList.add("displayNone");
    };
    localStorage.listDones = JSON.stringify(listDones);
  };
  
  function gotItDone(nb, color){
    console.log("gotItDone");
    console.log(nb);
    let donedTask = listTasks.splice(nb, 1).toString();
    console.log(donedTask);
    localStorage.listTasks = JSON.stringify(listTasks);
    let donedDate = getTodayDate(); //return
    let doned = {
      task: donedTask,
      color: color,
      date: donedDate
    };
    listDones.push(doned);
    localStorage.listDones = JSON.stringify(listDones);
    if(!document.getElementById(donedDate)){
        let donedUlP = document.createElement("p");
        donedUlP.setAttribute("id", donedDate + "p");
        donedUlP.innerText = donedDate;
        doneZone.appendChild(donedUlP);
        let donedUl = document.createElement("ul");
        donedUl.setAttribute("id", donedDate);
        donedUlP.insertAdjacentElement("afterend", donedUl);
      };
    let donedLi = document.createElement("li");
    donedLi.innerHTML = `<span class="typcn typcn-tick"></span>${doned.task}<span class="typcn typcn-trash trashCan" onclick="trashCanEvent(this)"></span>`;
    donedLi.style.color = color;
    document.getElementById(donedDate).appendChild(donedLi);
  };
  
  addForm.addEventListener("submit", (e) => {
    e.preventDefault();
    let newTask = addInput.value;
    let color = "darkslategrey";
    if(!newTask == ""){
      let todo = {
        task: newTask,
        color: color
      }
      listTasks.push(newTask);
      let li = document.createElement("li");
      li.innerHTML = `<span class="typcn typcn-media-stop-outline emptyCheck" onclick="checkEvent(this)"></span>${newTask}<span class="typcn typcn-tag colorSpan" onclick="colorChoice(this)"></span>`;
      localStorage.listTasks = JSON.stringify(listTasks);
      list.appendChild(li);
      addForm.reset();
      console.log(listTasks);
    };
  });
  
  nopeNextBtn.addEventListener("click", () => {
    if(listTasks.length == 0){
      taskToDo.innerText = "aller t'r'poser!";
    } else{
      num = num < (listTasks.length - 1) ? num + 1 : 0;
      taskToDo.innerText = listTasks[num];
    };
  });
  
  doneNextBtn.addEventListener("click", () => {
    let color;
    document.querySelectorAll("li").forEach(li => {
      if(li.innerText.includes(listTasks[num])){
        color = li.style.color;
        li.classList.add("displayNone");
      };
    });
    gotItDone(num, color);
    if(listTasks.length == 0){
      taskToDo.innerText = "aller t'reposer!";
    } else{
      num = num < listTasks.length ? num : 0;
      taskToDo.innerText = listTasks[num];
    };
  });
    
  backBtn.addEventListener("click", () => {
    listSection.classList.toggle("displayNone");
    toDoSection.classList.toggle("displayNone");
  });
  
  shuffleBtn.addEventListener("click", () => {
    for (let i = listTasks.length - 1; i > 0; i--) { 
      const j = Math.floor(Math.random() * (i + 1)); 
      [listTasks[i], listTasks[j]] = [listTasks[j], listTasks[i]]; 
    };
    //console.log(listTasks);
    list.innerHTML = ``;
    listTasks.forEach(todo => {
      let li = document.createElement("li");
      li.innerHTML = `<span class="typcn typcn-media-stop-outline emptyCheck" onclick="checkEvent(this)"></span>${todo.task}<span class="typcn typcn-tag colorSpan" onclick="colorChoice(this)"></span>`;
      li.style.color = todo.color;
      list.appendChild(li);
    });
    //list.classList.add("first");
    listSection.classList.toggle("displayNone");
    toDoSection.classList.toggle("displayNone");
    num = 0;
    taskToDo.innerText = listTasks[num];
  });
  
  function getTodayDate(){
    let date = new Date();
    let currentDay= String(date.getDate()).padStart(2, '0');
    let currentMonth = String(date.getMonth()+1).padStart(2,"0");
    let currentYear = date.getFullYear();
    let currentDate = `${currentDay}-${currentMonth}-${currentYear}`;
    //let currentDate = currentYear + "-" + currentMonth + "-" + currentDay;
    return currentDate;
  };
  
</script>
</body>

</html>